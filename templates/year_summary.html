{% extends 'base.html' %}
{% block title %}Сводный отчёт {{ year }}{% endblock %}

{% block content %}
<a href="{{ url_for('index') }}" class="text-blue-600 hover:underline">&larr; к месяцам</a>

<h1 class="text-3xl font-bold mb-8">Сводный отчёт за {{ year }}</h1>

<!--–– Карточки итогов года ––-->
<div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">

  <div class="bg-white rounded-2xl shadow p-8">
    <h2 class="text-xl font-semibold mb-4">Расходы</h2>
    <ul class="space-y-1">
      <li>Сахар: {{ '%.2f'|format(data.sugar) }}</li>
      <li>Эссенция: {{ '%.2f'|format(data.essence) }}</li>
      <li>Налог: {{ '%.2f'|format(data.tax) }}</li>
      <li>Вода: {{ '%.2f'|format(data.water) }}</li>
      <li>Электричество: {{ '%.2f'|format(data.electricity) }}</li>
      <li>Газ баллоны: {{ '%.2f'|format(data.gas) }}</li>
      <li>Прочие: {{ '%.2f'|format(data.other) }}</li>
    </ul>
    <hr class="my-3">
    <div class="font-semibold">Итого: {{ '%.2f'|format(data.expenses) }}</div>
  </div>

  <div class="bg-white rounded-2xl shadow p-8">
    <h2 class="text-xl font-semibold mb-4">Доход</h2>
    <div class="text-3xl font-bold">{{ '%.2f'|format(data.revenue) }}</div>
  </div>

  <div class="bg-white rounded-2xl shadow p-8">
    <h2 class="text-xl font-semibold mb-4">Прибыль</h2>
    <div class="text-3xl font-bold {{ '-text-red-600' if data.profit < 0 else 'text-green-600' }}">
      {{ '%.2f'|format(data.profit) }}
    </div>
  </div>

</div>

<!--–– Таблица помесячной детализации ––-->
<h2 class="text-2xl font-bold mb-4">Помесячная детализация</h2>

<div class="overflow-x-auto">
  <table class="min-w-full text-sm">
    <thead>
      <tr class="bg-gray-100">
        <th class="px-4 py-2 text-left">Месяц</th>
        <th class="px-4 py-2 text-right">Расходы</th>
        <th class="px-4 py-2 text-right">Доход</th>
        <th class="px-4 py-2 text-right">Прибыль</th>
      </tr>
    </thead>
    <tbody>
      {% for row in month_rows %}
      <tr class="border-t hover:bg-gray-50">
        <td class="px-4 py-2">{{ row.name }}</td>
        <td class="px-4 py-2 text-right">{{ '%.2f'|format(row.expenses) }}</td>
        <td class="px-4 py-2 text-right">{{ '%.2f'|format(row.revenue) }}</td>
        <td class="px-4 py-2 text-right {{ '-text-red-600' if row.profit < 0 else 'text-green-600' }}">
          {{ '%.2f'|format(row.profit) }}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
